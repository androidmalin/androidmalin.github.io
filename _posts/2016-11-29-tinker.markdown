---
layout: post
title:  "Tinker"
date:   2016-11-29 12:55 +0800
categories: Ma Lin update
---
0.check your version of gradle,if version>=2.14.1

1.DownLoad the source code of [tinker](https://github.com/Tencent/tinker) from github <br/>
`git clone git@github.com:Tencent/tinker.git`

2.Open the Sample project<br/>
`cd tinker/tinker-sample-android`

3.DownLoad the dependencies of sample,It may take a long time,you can drink a cup of coffee.<br/>
`gradle clean`

4.Buid debug apk<br/>
`gradle assembleDebug`

5.Install the debug base apk into your phone or emulator(e.g. [Genymotion](https://www.genymotion.com/),[Bluestacks](http://www.bluestacks.cn/bdsem_anmnq.html))<br/>
`adb install app/build/bakApk/*.apk`

6.Start the debug base apk<br/>
`adb shell am start tinker.sample.android/.app.MainActivity`

7.Change some codes in order to fix bugs<br/>

>TODO:// Coding in order to fix bug1<br/>
>TODO:// Coding in order to fix bug2<br/>


8.Get the base debug apk fileName<br/>
`find app/build/bakApk/ -type f -name *.apk -print | xargs ls -ltr | head -n 1 | awk '{print $9}' | cut -d  "/" -f 4`

9.Get "tinkerOldApkPath" first occurrence of rows <br/>
`grep -n "tinkerOldApkPath" app/build.gradle | head -n 1 | cut -d  ":" -f 1`

10.Change the config of app/build.gradle to Updte the tinkerOldApkPath<br/>
>Replace the line numbers which from number7 and apkName which from number8 <br/>

`sed -i 'number8-get-row-numbers/.*/tinkerOldApkPath="number7-get-apkname"/' app/build.gradle`

11.build patch apk<br/>
`gradle tinkerPatchDebug`

12.push patch apk into phone<br/>
You can user android Genymotion,BlueStacks,or else.<br/>
Your phone maybe need root<br/>
`adb push app/build/outputs/tinkerPatch/debug/patch_signed_7zip.apk /sdcard/`

13.click LOADPATH Button on the Sample App


14.kill the running apk or restart the running apk<br/>
`adb shell am force-stop tinker.sample.android`

or<br/>

./kill.sh<br/>

the content of kill.sh<br/>

![kill.sh](http://ogxkun013.bkt.clouddn.com/kill2.png)


a.`vim kill.sh && chmod 777 ./kill.sh`<br/>
b.input content of kill.sh<br/>
c.then `./kill.sh`

15.start apk<br/>
`adb shell am start tinker.sample.android/.app.MainActivity`

16.click showinfo in order to test patch success or not

17.test patch success or not<br/>
`adb logcat | grep tinker.sample.android`

18.change some codes in order to hot fix from number 8
